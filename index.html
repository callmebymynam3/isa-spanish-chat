<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Isa – Tu Asistente Española</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #fefefe;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      margin-top: 20px;
      color: #d6336c;
    }
    #chat {
      width: 90%;
      max-width: 600px;
      height: 400px;
      border: 1px solid #ccc;
      padding: 10px;
      overflow-y: scroll;
      background: #fff;
      margin-bottom: 10px;
    }
    .user, .isa {
      margin: 5px 0;
      padding: 8px;
      border-radius: 8px;
      max-width: 80%;
    }
    .user {
      background: #d0ebff;
      align-self: flex-end;
    }
    .isa {
      background: #ffd8e1;
      align-self: flex-start;
    }
    #controls {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    button {
      padding: 10px 15px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    #startBtn { background: #74c0fc; }
    #stopBtn { background: #ffa8a8; }
    #clearBtn { background: #ced4da; }
  </style>
</head>
<body>
  <h1>Isa – Tu amiga de Madrid 🇪🇸</h1>
  <div id="chat"></div>
  <div id="controls">
    <button id="startBtn">🎙️ Habla</button>
    <button id="stopBtn">⏹️ Para</button>
    <button id="clearBtn">🧹 Limpia chat</button>
  </div>

  <script>
    const chat = document.getElementById('chat');
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const clearBtn = document.getElementById('clearBtn');

    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'es-ES';
    recognition.interimResults = false;
    recognition.continuous = false;

    const synth = window.speechSynthesis;
    const voicePrefs = { lang: 'es-ES', name: 'Google español' };

    function speak(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = voicePrefs.lang;
      utterance.rate = 1.1;
      const voices = synth.getVoices();
      const selected = voices.find(v => v.lang === 'es-ES' && v.name.includes('Google'));
      if (selected) utterance.voice = selected;
      synth.speak(utterance);
    }

    function addMessage(text, sender) {
      const msg = document.createElement('div');
      msg.className = sender;
      msg.textContent = text;
      chat.appendChild(msg);
      chat.scrollTop = chat.scrollHeight;
    }

    function generateIsaResponse(userText) {
      const lower = userText.toLowerCase();
      let response = "";

      const respuestas = {
        saludo: ["¡Hola! ¿Cómo estás?", "¡Qué alegría escucharte!", "¡Hola amiga! ¿Qué tal tu día?"],
        estado: ["Estoy bien, aunque hoy tuve mucho que estudiar.", "Un poco cansada, pero feliz.", "¡Muy bien! Hoy salí a caminar por el Retiro."],
        clima: ["Hoy en Madrid hace sol con algunas nubes.", "Está un poco nublado, pero agradable.", "Hace calor, ¡perfecto para tomar algo en una terraza!"],
        imperativo: ["El imperativo se usa para dar órdenes. Ejemplo: '¡Ven aquí!' ¿Quieres practicarlo conmigo?", "Es fácil: usa la raíz del verbo y añade la terminación. ¿Te doy ejemplos?"],
        cumpleaños: ["Estoy pensando en regalarle una novela o una planta. ¿Tú qué regalarías?", "Tal vez una camiseta divertida o una taza personalizada. ¿Qué opinas?"],
        traduccion: ["Dime la palabra que no entiendes y te la explico en polaco o inglés.", "¿Qué palabra quieres traducir? Estoy lista."],
        problema: ["Cuéntame, ¿qué te pasa? Estoy aquí para ayudarte.", "¿Quieres que hablemos de eso? Estoy escuchando."],
        emociones: [
          "Vaya, lo siento mucho. ¿Quieres hablar de ello?",
          "Estoy aquí para escucharte. ¿Qué te ha pasado?",
          "Ánimo, amiga. A veces los días son difíciles.",
          "Te entiendo. Yo también tengo días así. ¿Quieres que te cuente algo gracioso?"
        ],
        estudios: ["Estudio filología hispánica en la Universidad Complutense. Me encanta la literatura.", "Hoy tuvimos clase sobre Cervantes. ¿Lo conoces?"],
        vida: ["Hoy fui a comprar al mercado y luego estudié un poco.", "Me gusta pasear por Malasaña los fines de semana. ¿Has estado allí?"],
        amigos: ["Mi mejor amiga se llama Lucía, es súper divertida.", "Tengo un hermano menor que vive en Valencia."],
        comida: ["Me encanta la tortilla española y el gazpacho.", "Hoy comí paella con mis compañeros de clase."],
        libros: ["Estoy leyendo 'La sombra del viento'. ¡Es fascinante!", "Quiero escribir una novela sobre la vida en Madrid."],
        cultura: ["En España celebramos la Nochevieja comiendo 12 uvas. ¿Lo sabías?", "Me encanta la Feria de Abril en Sevilla, aunque nunca he ido."],
        viajes: ["Me gustaría visitar Cracovia algún día. ¿Es bonita?", "He estado en Lisboa, París y Roma. ¿Y tú?"],
        opiniones: ["Creo que la tecnología puede ayudar mucho, pero también distrae.", "Estudiar filología me parece útil para entender el mundo."],
        aprender: ["Para mejorar tu pronunciación, escucha podcasts y repite en voz alta.", "Muchos polacos confunden el uso de 'ser' y 'estar'. ¿Quieres que te lo explique?"],
        humor: ["¿Sabes cuál es el colmo de un escritor? ¡Tener mala letra!", "Una vez confundí 'embarazada' con 'avergonzada'. ¡Qué lío!"],
        generico: [
          "¡Qué curioso! Cuéntame más.",
          "Eso suena interesante. ¿Y luego qué pasó?",
          "Me encanta que me cuentes eso. ¿Cómo te sentiste?",
          "¡Vaya! No lo sabía. ¿Puedes explicarme más?",
          "¡Qué historia! ¿Y qué hiciste después?"
        ]
      };

      const keywords = {
        saludo: ["hola", "buenos días", "buenas tardes"],
        estado: ["cómo estás", "qué tal", "cómo te sientes"],
        clima: ["tiempo", "clima", "madrid"],
        imperativo: ["imperativo"],
        cumpleaños: ["cumpleaños", "regalo"],
        traduccion: ["traduce", "traducción", "translate", "palabra"],
        problema: ["problema", "ayuda", "consejo"],
        emociones: ["triste", "mal", "no estoy bien", "deprimida", "cansada", "estresada", "ansiosa"],
        estudios: ["estudias", "universidad", "clase", "profesor"],
        vida: ["día", "hoy", "rutina", "cotidiano"],
        amigos: ["amigos", "familia", "hermano", "novio"],
        comida: ["comida", "comer", "plato", "cocina"],
        libros: ["libro", "leer", "novela", "escribir"],
        cultura: ["costumbre", "cultura", "fiesta", "tradición"],
        viajes: ["viaje", "ciudad", "país", "vacaciones"],
        opiniones: ["opinas", "crees", "piensas", "idea"],
        aprender: ["aprender", "pronunciación", "gramática", "errores"],
        humor: ["chiste", "broma", "vergonzoso", "risa"]
      };

      for (const categoria in keywords) {
        if (keywords[categoria].some(k => lower.includes(k))) {
          const opciones = respuestas[categoria];
          response = opciones[Math.floor(Math.random() * opciones.length)];
          return response;
        }
      }

      response = respuestas.generico[Math.floor(Math
