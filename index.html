<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Javier – Twój Asystent AI po Hiszpańsku</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f0f0f0; }
    h1 { text-align: center; color: #333; }
    #chat { border: 1px solid #ccc; padding: 10px; height: 400px; overflow-y: auto; background: #fff; }
    .message { margin: 5px 0; }
    .user { color: blue; }
    .javier { color: green; }
    button { margin: 5px; padding: 10px; }
    select { margin: 5px; padding: 5px; }
  </style>
</head>
<body>
  <h1>Javier – Twój Asystent AI po Hiszpańsku</h1>

  <div id="chat"></div>

  <button id="startRecording">🎤 Mów</button>
  <button id="stopRecording">⏹️ Stop</button>
  <button id="translateBtn">🌐 Tłumacz słowo</button>
  <button id="grammarBtn">📖 Sprawdź gramatykę</button>

  <label>Tempo:</label>
  <select id="speedSelect">
    <option value="normal">Normalne</option>
    <option value="slow">Wolno</option>
    <option value="fast">Szybko</option>
  </select>

  <label>Poziom:</label>
  <select id="levelSelect">
    <option value="beginner">Początkujący</option>
    <option value="intermediate">Średniozaawansowany</option>
    <option value="advanced">Zaawansowany</option>
  </select>

  <script>
    // ================== Konfiguracja OpenAI ==================
    const OPENAI_API_KEY = "TWÓJ_KLUCZ_OPENAI"; // wstaw swój klucz API
    const chatDiv = document.getElementById("chat");
    let chatHistory = [];

    // ================== Web Speech API ==================
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = "es-ES";
    recognition.interimResults = false;

    recognition.onresult = async (event) => {
      const userText = event.results[0][0].transcript;
      addMessage("user", userText);
      await sendMessageToJavier(userText);
    };

    recognition.onerror = (event) => {
      console.error(event.error);
      alert("Błąd rozpoznawania mowy: " + event.error);
    };

    document.getElementById("startRecording").onclick = () => recognition.start();
    document.getElementById("stopRecording").onclick = () => recognition.stop();

    function addMessage(sender, text) {
      const div = document.createElement("div");
      div.className = "message " + sender;
      div.textContent = (sender === "user" ? "Ty: " : "Javier: ") + text;
      chatDiv.appendChild(div);
      chatDiv.scrollTop = chatDiv.scrollHeight;
    }

    async function sendMessageToJavier(text) {
      chatHistory.push({ role: "user", content: text });

      const speed = document.getElementById("speedSelect").value;
      const level = document.getElementById("levelSelect").value;

      const systemContent = `
        Eres Javier, amigo de España que habla español estándar (Valladolid). 
        Conversa de forma natural y amistosa. No traduzcas ni expliques la gramática a menos que el usuario lo pida.
        Habla ${speed === "slow" ? "más despacio y claro" : speed === "fast" ? "rápido como nativo" : "a velocidad normal"}.
        Adapta tu vocabulario y estructuras al nivel: ${level}.
      `;

      try {
        const response = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${OPENAI_API_KEY}`
          },
          body: JSON.stringify({
            model: "gpt-5-mini",
            messages: [{ role: "system", content: systemContent }, ...chatHistory]
          })
        });

        const data = await response.json();
        const javierReply = data.choices[0].message.content;
        chatHistory.push({ role: "assistant", content: javierReply });
        addMessage("javier", javierReply);

        // ================== Text-to-Speech ==================
        const utterance = new SpeechSynthesisUtterance(javierReply);
        utterance.lang = "es-ES";
        utterance.rate = speed === "slow" ? 0.8 : speed === "fast" ? 1.2 : 1.0;
        speechSynthesis.speak(utterance);

      } catch (err) {
        console.error(err);
        addMessage("javier", "Ups, coś poszło nie tak z Javierem 😅");
      }
    }

    // ================== Tłumaczenie / Gramatyka ==================
    document.getElementById("translateBtn").onclick = async () => {
      const lastUser = chatHistory.filter(m => m.role === "user").pop();
      if (!lastUser) return alert("Brak słówka do przetłumaczenia!");
      const word = lastUser.content.split(" ").pop();

      const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${OPENAI_API_KEY}`
        },
        body: JSON.stringify({
          model: "gpt-5-mini",
          messages: [{ role: "user", content: `Przetłumacz na polski słowo: ${word} i wytłumacz prosto.` }]
        })
      });

      const data = await response.json();
      const translation = data.choices[0].message.content;
      addMessage("javier", translation);
    };

    document.getElementById("grammarBtn").onclick = async () => {
      const lastUser = chatHistory.filter(m => m.role === "user").pop();
      if (!lastUser) return alert("Brak wiadomości do sprawdzenia!");
      const text = lastUser.content;

      const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${OPENAI_API_KEY}`
        },
        body: JSON.stringify({
          model: "gpt-5-mini",
          messages: [{ role: "user", content: `Sprawdź poprawność gramatyczną zdania po hiszpańsku: ${text} i wytłumacz prostym językiem.` }]
        })
      });

      const data = await response.json();
      const grammarCheck = data.choices[0].message.content;
      addMessage("javier", grammarCheck);
    };
  </script>
</body>
</html>

